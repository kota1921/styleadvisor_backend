<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/infra/nginx_site.conf">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/infra/nginx_site.conf" />
              <option name="originalContent" value="server {&#10;    listen 80;&#10;    server_name fitmind.at www.fitmind.at;&#10;    return 308 https://$host$request_uri;&#10;}&#10;&#10;server {&#10;    listen 443 ssl http2;&#10;    server_name fitmind.at www.fitmind.at;&#10;&#10;    ssl_certificate /etc/letsencrypt/live/fitmind.at/fullchain.pem;&#10;    ssl_certificate_key /etc/letsencrypt/live/fitmind.at/privkey.pem;&#10;    include /etc/letsencrypt/options-ssl-nginx.conf;&#10;    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;&#10;&#10;    client_max_body_size 2m;&#10;&#10;    # Общий прокси для остальных путей&#10;    location / {&#10;        proxy_pass http://127.0.0.1:8000;&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        proxy_set_header X-Forwarded-Host $host;&#10;        proxy_set_header Connection &quot;&quot;;&#10;    }&#10;&#10;    # Все ручки авторизации /auth/*&#10;    location /auth/ {&#10;        proxy_pass http://127.0.0.1:8000;  # сохраняем оригинальный URI (/auth/google, /auth/logout)&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        proxy_set_header X-Forwarded-Host $host;&#10;        proxy_set_header Connection &quot;&quot;;&#10;    }&#10;}&#10;&#10;# SSL блок добавит certbot автоматически после выдачи сертификата.&#10;" />
              <option name="updatedContent" value="upstream styleadvisor_backend {&#10;    server 127.0.0.1:8000;&#10;    keepalive 32;&#10;}&#10;&#10;server {&#10;    listen 80;&#10;    server_name fitmind.at www.fitmind.at;&#10;    return 308 https://$host$request_uri;&#10;}&#10;&#10;server {&#10;    listen 443 ssl http2;&#10;    server_name fitmind.at www.fitmind.at;&#10;&#10;    ssl_certificate /etc/letsencrypt/live/fitmind.at/fullchain.pem;&#10;    ssl_certificate_key /etc/letsencrypt/live/fitmind.at/privkey.pem;&#10;    include /etc/letsencrypt/options-ssl-nginx.conf;&#10;    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;&#10;&#10;    client_max_body_size 2m;&#10;    proxy_intercept_errors off;&#10;&#10;    # Общий прокси для остальных путей&#10;    location / {&#10;        proxy_pass http://styleadvisor_backend;&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        proxy_set_header X-Forwarded-Host $host;&#10;        proxy_set_header X-Forwarded-Server $host;&#10;        proxy_set_header Connection &quot;&quot;;&#10;    }&#10;&#10;    # Все ручки авторизации /auth/* (общий)&#10;    location /auth/ {&#10;        proxy_pass http://styleadvisor_backend;&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        proxy_set_header X-Forwarded-Host $host;&#10;        proxy_set_header X-Forwarded-Server $host;&#10;        proxy_set_header Connection &quot;&quot;;&#10;    }&#10;&#10;    # Точный матч /auth/google&#10;    location = /auth/google {&#10;        proxy_pass http://styleadvisor_backend/auth/google;&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        proxy_set_header X-Forwarded-Host $host;&#10;        proxy_set_header X-Forwarded-Server $host;&#10;        proxy_set_header Connection &quot;&quot;;&#10;    }&#10;&#10;    # Точный матч /auth/logout&#10;    location = /auth/logout {&#10;        proxy_pass http://styleadvisor_backend/auth/logout;&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        proxy_set_header X-Forwarded-Host $host;&#10;        proxy_set_header X-Forwarded-Server $host;&#10;        proxy_set_header Connection &quot;&quot;;&#10;    }&#10;}&#10;&#10;# SSL блок добавит certbot автоматически после выдачи сертификата." />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>